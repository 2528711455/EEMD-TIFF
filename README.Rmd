---
output:
  rmarkdown::github_document:
    html_preview: no
---

```{r, include = FALSE}
knitr::opts_chunk$set(fig.path = "man/figures/README-", fig.align = "center",
                      fig.height = 4.5, fig.width = 4.5)
```

<!--- README.md is generated from README.Rmd. Please edit that file -->

## wdpar: Interface to the World Database on Protected Areas
[![lifecycle](https://img.shields.io/badge/Lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![Travis Build Status](https://img.shields.io/travis/prioritizr/wdpar/master.svg?label=Linux%20%26%20Mac%20OSX)](https://travis-ci.org/prioritizr/wdpar)
[![AppVeyor Build Status](https://img.shields.io/appveyor/ci/jeffreyhanson/wdpar/master.svg?label=Windows)](https://ci.appveyor.com/project/jeffreyhanson/wdpar)
[![Coverage Status](https://codecov.io/github/prioritizr/wdpar/coverage.svg?branch=master)](https://codecov.io/github/prioritizr/wdpar?branch=master)
[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/wdpar)](https://CRAN.R-project.org/package=wdpar)

```{r, include = FALSE}
devtools::load_all()
```

### Overview

The _wdpar R_ package provides an interface to the World Database on
Protected Areas (WDPA). It provides functions for automatically downloading
data (from [Protected Planet](http://protectedplanet.net)) and cleaning
data following best practices (outlined in [Butchart _et al._ 2015](https://dx.doi.org/10.1111/conl.12158); [Runge _et al._ 2015](https://dx.doi.org/10.1126/science.aac9180); and [Protected Planet](https://www.protectedplanet.net/c/calculating-protected-area-coverage)).

### Installation

To install the developmental version of _wdpar_, use the following _R_ code:

```{r, eval = FALSE}
if (!require(devtools))
  install.packages("devtools")
devtools::install_github("prioritizr/wdpar")
```

### Usage

Here we will provide a short introduction to the _wdpar R_ package. First, we will load the _wdpar R_ package. We will also load the _sf_ and _dplyr R_ packages to help explore the data.

```{r, message = FALSE, warning = FALSE}
# load packages
library(wdpar)
library(dplyr)
library(ggmap)
```

Now we will download protected area data for Malta. Note that we could have alternatively downloaded the data using Malta's [ISO3 code](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3) (MLT).

```{r}
# download protected area data for Malta
mlt_raw_pa_data <- wdpa_fetch("Malta", wait = TRUE)
```

Next, we will clean the data set. See `?wdpa_clean` for a detailed description of the data cleaning process.

```{r}
# clean Malta data
mlt_pa_data <- wdpa_clean(mlt_raw_pa_data)
```

Print preview of the data associated with each protected area.

```{r}
# print preview
head(mlt_pa_data)
```

Finally, after cleaning the data, let's plot a map showing Malta's protected areas and color each area according to its management category ([as defined by the The International Union for Conservation of Nature](https://www.iucn.org/theme/protected-areas/about/protected-area-categories)).

```{r, message = FALSE, warning = FALSE}
# reproject data to longitude/latitude for plotting
mlt_pa_data <- st_transform(mlt_pa_data, 4326)

# download basemap imagery
bg <- get_stamenmap(unname(st_bbox(mlt_pa_data)), zoom = 8,
                    maptype = "watercolor", force = TRUE)

# make map
ggmap(bg) +
geom_sf(aes(fill = IUCN_CAT), data = mlt_pa_data, inherit.aes = FALSE) +
theme(axis.title = element_blank(), legend.position = "bottom")
```

For more examples using the _wdpar R_ package, please refer to the [package vignette](https://github.com/prioritizr/wdpar/articles/wdpar.html).

### Citation

Please cite the _wdpar R_ package and the World Database on Protected Areas (WDPA) in publications.

```{r, echo  = FALSE, result = "asis", comment = ""}
citation("wdpar")
```
