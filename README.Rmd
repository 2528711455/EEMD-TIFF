---
output:
  rmarkdown::github_document:
    html_preview: no
---

```{r, include = FALSE}
knitr::opts_chunk$set(fig.path = "man/figures/README-", fig.align = "center")
```

<!--- README.md is generated from README.Rmd. Please edit that file -->

## wdpar: Interface to the World Database on Protected Areas

[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](http://www.repostatus.org/badges/latest/active.svg)](http://www.repostatus.org/#active)
[![Travis Build Status](https://img.shields.io/travis/jeffreyhanson/wdpar/master.svg?label=Mac%20OSX%20%26%20Linux)](https://travis-ci.org/jeffreyhanson/wdpar)
[![AppVeyor Build Status](https://img.shields.io/appveyor/ci/jeffreyhanson/wdpa/master.svg?label=Windows)](https://ci.appveyor.com/project/jeffreyhanson/wdpar)
[![Coverage Status](https://codecov.io/github/jeffreyhanson/wdpa/coverage.svg?branch=master)](https://codecov.io/github/jeffreyhanson/wdpar?branch=master)
[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/wdpa)](https://CRAN.R-project.org/package=wdpar)

```{r, include = FALSE}
devtools::load_all()
```

### Overview

The _wdpar R_ package provides an interface to the World Database on
Protected Areas (WDPA). It provides functions for automatically downloading
data (from [Protected Plane](http://protectedplanet.net)) and cleaning
data following best practices (outlined in [Butchart _et al._ 2015](https://dx.doi.org/10.1111/conl.12158) and [Runge _et al._ 2015](https://dx.doi.org/10.1126/science.aac9180)).

### Installation

To install the developmental version of _wdpar_, use the following _R_ code:

```{r, eval = FALSE}
if (!require(devtools))
  install.packages("devtools")
devtools::install_github("jeffreyhanson/wdpar")
```

### Example usage

Here we will provide a short introduction to the _wdpar R_ package.

First, we will load the _wdpar R_ package. We will also load the _sf_ and _dplyr R_ packages to help explore protected area data.

```{r, message = FALSE, warning = FALSE}
# load packages
library(wdpar)
library(sf)
library(units)
library(dplyr)
```

Now we will download protected area data for Malta. Note that we could have alternatively downloaded the data using Malta's [ISO3 code](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3) (MLT).

```{r}
# download protected area data for Malta
mlt_raw_pa_data <- wdpa_fetch("Malta", wait = TRUE)
```

Next, we will clean the data set. See the help page for `wdpa_clean` for a detailed description of the data cleaning process.

```{r}
# clean Malta data
mlt_pa_data <- wdpa_clean(mlt_raw_pa_data)
```

Now that we have finished cleaning the data, let's calculate some statistics. We can calculate the total amount of area inside inside Malta's protected area system (km$^2$). Note that this statistic includes marine and terrestrial protected areas.

```{r}
# calculate total amount of area inside protected areas (km^2)
statistic <- mlt_pa_data %>%
             as.data.frame %>%
             summarize(area = sum(AREA_KM2))

# print statistic
print(statistic)
```

We can also calculate the percentage of land inside [protected areas that are designated strictly to protect biodiversity (and also potentially geological/geomorphological features)](https://www.iucn.org/theme/protected-areas/about/protected-area-categories).

```{r}
# fetch spatial data for Malta's land mass and calculate its area (km^2)
mlt_land_data <- land_and_eez_fetch("Malta") %>%
                 filter(TYPE == "LAND") %>%
                 summarize(area = set_units(st_area(.), km^2))

# calculate percentage of land inside protected areas (km^2)
statistic <- mlt_pa_data %>%
             as.data.frame %>%
             filter(MARINE == "terrestrial", IUCN_CAT == "Ia") %>%
             summarize(area_protected = sum(AREA_KM2)) %>%
             mutate(total_land_area = mlt_land_data[["area"]]) %>%
             mutate(percentage_protected = (area_protected / total_land_area) *
                                           100)

# print statistic
print(statistic)
```

Finally, let's plot a map showing Malta's protected areas and color each area according to its management category.

```{r, fig.height = 2.5, fig.width = 4.5}
plot(mlt_pa_data[, "IUCN_CAT"], main = "IUCN Category", key.size = lcm("4"))
```

### Citation

Please use the following references for citing the _wdpar R_ package and the World Database on Protected Areas (WDPA) in publications.

```{r, echo  = FALSE, result = "asis", comment = ""}
citation("wdpar")
```
